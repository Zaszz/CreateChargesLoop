--WARNING THIS SCRIPT MAY CAUSE ISSUES USE WITH CAUTION!  NEVER USE ON A CLIENT!  FOR IN HOUSE TESTING ONLY!
--Change these to meet your needs
declare @practiceid varchar(4) = '0001' --set to practice ID
declare @enterpriseid varchar(5) = '00001' --set to enterprise id
declare @loopcount int = 1 --number of charges to create, change number to whatever number of charges you want to be created

--no touchie these ones
declare @service_item_lib_id uniqueidentifier = (select service_item_lib_id from practice_misc where practice_id = @practiceid) --gets your current sim lib, no touchie
declare @diaglib uniqueidentifier = (select diagnosis_code_lib_id from practice_misc where practice_id = @practiceid) --gets your current diag lib, no touchie
declare @encid uniqueidentifier --generated in the loop, no touchie
declare @personid uniqueidentifier -- generated in the loop, no touchie
declare @personpayerid uniqueidentifier -- no touchie
declare @sim varchar(12) -- generated in the loop, no touchie
declare @simdesc varchar(80) -- generated in the loop, no touchie
declare @cpt4 varchar(13) -- no touchie
declare @prov uniqueidentifier --no touchie
declare @location uniqueidentifier  --no touchie
declare @newid uniqueidentifier -- no touchie
declare @payerid uniqueidentifier--no touch
declare @encnbr numeric(12, 0)-- no do it!
declare @diag varchar(10) = (select top 1 icd9cm_code_id from icd9cm_code_mstr where delete_ind = 'N' and eff_date < (SELECT CONVERT(VARCHAR(8),GETDATE(),112)) and exp_date > (SELECT CONVERT(VARCHAR(8),GETDATE(),112)))
declare @diagdesc varchar(255) = (select top 1 description from icd9cm_code_mstr where icd9cm_code_id = @diag)

while @loopcount > 0 --being loop
begin
set @encnbr = (select 1+(select top 1 enc_nbr from patient_encounter where practice_id = @practiceid and enterprise_id = @enterpriseid order by enc_nbr desc))-- set up the next encounter number to be higher
--pick a random patient who has an active person payer, is from our practice and enterprise, and isnt expired
set @personid = (select top 1 person_id from patient where person_id in (select person_id from person_payer where active_ind = 'Y' and policy_exp_date <= getdate()) and person_id in (select person_id from person where expired_ind = 'N')
and person_id = guar_id and enterprise_id = @enterpriseid and practice_id = @practiceid order by newid())
--pick the person payer to use
set @personpayerid = (select top 1 person_payer_id from person_payer where person_id = @personid and person_payer_id in (select person_payer_id from practice_payers_person where practice_id = @practiceid ) order by newid())
set @payerid = (select top 1 payer_id from person_payer where person_payer_id = @personpayerid)
--Pick a provider for the encounter
set @prov = (select top 1 provider_id from provider_mstr where provider_id in (select provider_id from provider_practice_mstr where practice_id = @practiceid and enterprise_id = @enterpriseid and attending_ind = 'Y') order by newid())
--pick a new id for the encounter to use
set @newid = newid()
--pick a location
set @location = (select top 1 location_id from patient_encounter where enterprise_id = @enterpriseid and practice_id = @practiceid order by newid())
--pick a random active sim
set @sim = (select top 1 service_item_id from service_item_mstr where service_item_lib_id = @service_item_lib_id and exp_date > getdate() group by service_item_id order by newid())
--get its description
set @simdesc = (select top 1 description from service_item_mstr where service_item_lib_id = @service_item_lib_id and service_item_id = @sim order by create_timestamp desc)
--get the cpt4 that goes with it
set @cpt4 = (select top 1 cpt4_code_id from service_item_mstr where service_item_lib_id = @service_item_lib_id and service_item_id = @sim order by create_timestamp desc)



--create an encounter for them
INSERT INTO [dbo].[patient_encounter] ([enterprise_id] ,[practice_id] ,[site_id] ,[person_id] ,[enc_id] ,[enc_timestamp] ,[enc_nbr] ,[parent_enc_id] ,[case_id] ,[billable_ind] ,[clinical_ind] ,[optical_ind] ,[location_id] ,[locked_by] ,[lock_ind] ,[billable_timestamp] ,[enc_status] ,[complaint] ,[remarks] ,[user_defined1] ,[user_defined2] ,[user_defined3] ,[user_defined4] ,[guar_id] ,[guar_type] ,[cob1_insured_person_id] ,[cob1_payer_id] ,[auto_accd_loc] ,[cond_rel_emp_ind] ,[rendering_provider_id] ,[admit_provider_id] ,[admit_provider_name] ,[consult1_provider_id] ,[consult1_provider_name] ,[consult2_provider_id] ,[consult2_provider_name] ,[refer_provider_id] ,[refer_provider_name] ,[refer_location_id] ,[patient_type_id] ,[onset_date] ,[onset_time] ,[admit_date] ,[discharge_date] ,[accident_code] ,[final_bill_date] ,[last_bill_date] ,[pat_resp_date] ,[budget_ind] ,[bad_debt_prelist_date] ,[print_stmt_ind] ,[last_statement_date] ,[pre_list_ind] ,[pre_list_eff_date] ,[agency_id] ,[send_coll_letter_ind] ,[collection_letter_id] ,[sim_prompt_ind] ,[followup_date] ,[followup_ind] ,[homebound_ind] ,[reinstate_date] ,[bill_hold_date] ,[type_of_bill] ,[supervisor_provider_id] ,[checkin_datetime] ,[checkout_datetime] ,[ub92_enc_ind] ,[ub92_linked_enc_id] ,[ud_billing_collections1] ,[ud_billing_collections2] ,[ud_billing_collections3] ,[ud_billing_collections4] ,[sim_emr_prompt_ind] ,[service_auth_excep_cd] ,[same_similar_symp_date] ,[last_print_statement_date] ,[special_program_code] ,[bad_debt_status_id] ,[cob1_person_payer_id] ,[lock_timestamp] ,[sliding_fee_action_ind] ,[last_seen_date] ,[delay_reason_cd] ,[epsdt_ref_cond_code] ,[sim_ext_prompt_ind] ,[old_enc_id] ,[height] ,[weight] ,[bp_systolic] ,[bp_diastolic] ,[pulse] ,[temperature] ,[ud_clinical1] ,[ud_clinical2] ,[ud_clinical3] ,[ud_clinical4] ,[fqhc_enc_ind] ,[facility_location_id] ,[created_by] ,[create_timestamp] ,[modified_by] ,[modify_timestamp] ,[outsource_exempt_ind] ,[epsdt_ref_code] ,[prim_er_billing_status] ,[sec_er_billing_status] ,[group_id] ,[group_enc_id] ,[incident_to_enc_ind] ,[source_product_id] ,[family_planning_ind] ,[elig_data_check_ind] ,[eligibility_id] ,[pwk_report_type_cd] ,[pwk_report_trans_cd] ,[pwk_attach_ctrl_nbr] ,[epsdt_enc_code] ,[epsdt_enc_code_other] ,[fqhc_dirty_ind] ,[fqhc_update_date] ,[init_treatment_date] ,[mrkt_plan_id] ,[mrkt_source_id] ,[mrkt_comments] ,[mrkt_details] ,[mrkt_source_type] ,[casemgt_case_id] ,[ter_er_billing_status] ,[ub92_initial_enc_id] ,[tax_rate_ind] ,[enc_timestamp_tz] ,[billable_timestamp_tz] ,[checkin_datetime_tz] ,[checkout_datetime_tz] ,[lock_timestamp_tz] ,[create_timestamp_tz] ,[modify_timestamp_tz] ,[enc_tax_rate_ind] ,[uds_homeless_status_id] ,[pwk_report_type_cd_2] ,[pwk_report_trans_cd_2] ,[pwk_attach_ctrl_nbr_2] ,[pwk_report_type_cd_3] ,[pwk_report_trans_cd_3] ,[pwk_attach_ctrl_nbr_3] ,[pwk_report_type_cd_4] ,[pwk_report_trans_cd_4] ,[pwk_attach_ctrl_nbr_4] ,[pwk_report_type_cd_5] ,[pwk_report_trans_cd_5] ,[pwk_attach_ctrl_nbr_5] ,[pwk_report_type_cd_6] ,[pwk_report_trans_cd_6] ,[pwk_attach_ctrl_nbr_6] ,[pwk_report_type_cd_7] ,[pwk_report_trans_cd_7] ,[pwk_attach_ctrl_nbr_7] ,[pwk_report_type_cd_8] ,[pwk_report_trans_cd_8] ,[pwk_attach_ctrl_nbr_8] ,[pwk_report_type_cd_9] ,[pwk_report_trans_cd_9] ,[pwk_attach_ctrl_nbr_9] ,[pwk_report_type_cd_10] ,[pwk_report_trans_cd_10] ,[pwk_attach_ctrl_nbr_10] ,[vision_code_category] ,[vision_condition_ind_cd] ,[vision_code_category_2] ,[vision_condition_ind_cd_2] ,[vision_code_category_3] ,[vision_condition_ind_cd_3] ,[not_assigned_prov_elec_ind] ,[hearing_vision_rx_date] ,[statement_counter] ,[prim_enc_rate_sim] ,[sec_enc_rate_sim] ,[ter_enc_rate_sim] ,[prim_enc_rate_amt] ,[sec_enc_rate_amt] ,[ter_enc_rate_amt] ,[pm_ind] ,[convert_in_progress_ind] ,[rental_ind] ,[rental_id] ,[enc_changes_service_date] ,[enc_changes_location_id] ,[enc_changes_payer_id] ,[enc_changes_person_payer_id] ,[enc_changes_payer_2_id] ,[enc_changes_person_payer_2_id] ,[enc_changes_payer_3_id] ,[enc_changes_person_payer_3_id] ,[enc_changes_appr_enc_id] ,[recalc_fail_ind] ,[claim_codes] ,[wc_cond_codes] ,[wc_cond_codes_other] ,[medical_director_id] ,[anes_types_cd] ,[anes_phys_status_cd] ,[anes_med_dir_cd] ,[exempt_enc_concur_ind] ,[present_induction_ind] ,[zero_bal_ind] ,[demonstration_project_id] ,[csc_pri_resp_attending] ,[csc_sec_resp_attending] ,[csc_ter_resp_attending] ,[csc_pri_exempt_ind] ,[csc_sec_exempt_ind] ,[csc_ter_exempt_ind] ,[admit_time] ,[discharge_time] ,[prim_er_narrative] ,[sec_er_narrative] ,[ter_er_narrative] ,[ordering_provider_id] ,[ordering_provider_name] ,[csc_pri_elig_from_date] ,[csc_pri_elig_to_date] ,[csc_sec_elig_from_date] ,[csc_sec_elig_to_date] ,[csc_ter_elig_from_date] ,[csc_ter_elig_to_date] ,[csc_lib_timespan_id_pri] ,[csc_lib_timespan_id_sec] ,[csc_lib_timespan_id_ter] ,[discharge_status_cd] ,[medications_reconciled])
VALUES 
(@enterpriseid,@practiceid,'000' ,@personid ,@newid,
getdate(),@encnbr,null,'00000000-0000-0000-0000-000000000000',
'Y' ,'N','N',@location,null,
'N',getdate(),'U',null,null,
null,null,null,null,@personid,
'P' ,@personid,@payerid,null,'N',
@prov,NULL,	NULL,	NULL,	NULL,	NULL,
	NULL,	NULL,	NULL,	NULL,	NULL,	
	NULL,	NULL,	NULL,	NULL,	NULL,
	NULL,	NULL,	NULL,	'N',	NULL,
	'Y',	NULL,	'Y',	NULL,	NULL,	
	'N',	NULL,	'N',	NULL,	'N',
	'N',	NULL,	NULL,	NULL,	NULL,
	NULL,	NULL,	'N',	NULL,	NULL,	
	NULL,	NULL,	NULL,	'N',	NULL,		NULL,	NULL,	NULL,	NULL,	@personpayerid,getdate(),	'N',NULL,	NULL,	NULL,	'N',NULL,	NULL,	NULL,	'0','0','0',NULL,	NULL,	NULL,	NULL,	NULL,	'N',NULL,	'0',getdate(),	'0',getdate(),	'N',NULL,	'U',	'U',	NULL,	NULL,	'N',NULL,	'N','N',NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'Y',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'Y',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',NULL,	'0',NULL,	NULL,	NULL,	'0.00','0.00','0.00','N','N','N',NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N','N','N',NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL)

--add the payer to the encounter
INSERT INTO [dbo].[encounter_payer]            ([enterprise_id]            ,[practice_id]            ,[person_id]            ,[enc_id]            ,[cob]            ,[payer_id]            ,[person_payer_id]            ,[insured_person_id]            ,[encounter_copay_amt]            ,[ins_type]            ,[claim_type]            ,[notify_user_id]            ,[verify_date]            ,[precert_nbr]            ,[assign_benefits_code]            ,[release_of_info]            ,[pro_date]            ,[pro_procedure]            ,[pro_state]            ,[opt_claim_value_1]            ,[notify_date]            ,[verify_user_id]            ,[gabetterhealth_nbr]            ,[use_rem_enc_auth_ind]            ,[auth_code_id]            ,[created_by]            ,[modified_by]            ,[create_timestamp]            ,[modify_timestamp]            ,[copay_exempt_ind]            ,[referral_nbr]            ,[referral_id]            ,[use_rem_enc_ref_ind]            ,[pm_ind]            ,[property_casualty_nbr]            ,[Appl_placed_date]            ,[Appl_rmved_date])
     
VALUES            (@enterpriseid,	@practiceid,	@personid,	@newid,	'1',	@payerid, @personpayerid,	@personid,	NULL,	NULL,	NULL,	NULL,	'','',		'Y',	'Y', 	NULL,	'','','','',				NULL,'',		'N',	NULL,	'0',	'0',	getdate(),	getdate(),		'N',	NULL,	NULL,	'N',	'N',	NULL,	NULL,	NULL)

--add charges to the encounter
INSERT INTO [dbo].[charges]([enterprise_id],[practice_id],[emr_uniq_id],[line_item_ctl],[charge_id],[person_id],[source_id],[source_type],[location_id],[service_item_lib_id],[service_item_id],[cob1_amt],[cob2_amt],[cob3_amt],[pat_amt],[amt],[quantity],[unit_price],[override_ind],[begin_date_of_service],[end_date_of_service],[modifier_1],[modifier_2],[modifier_3],[modifier_4],[status],[rendering_id],[midlevel_id],[cpt4_code_id],[place_of_service],[icd9cm_code_id],[icd9cm_code_id_2],[icd9cm_code_id_3],[icd9cm_code_id_4],[icd9cm_code_desc],[icd9cm_code_desc_2],[icd9cm_code_desc_3],[icd9cm_code_desc_4],[invoice_desc_1],[invoice_desc_2],[zero_bal_date],[proc_claim_cob1_ind],[proc_claim_cob2_ind],[proc_claim_cob3_ind],[pat_bal_increase_date],[closing_date],[seq_nbr],[revenue_code],[narrative],[link_id],[exception_origin],[external_id],[batch_info],[override_closing_date],[revenue_description],[value_code],[occur_code],[nyhcra_surcharge_action_ind],[sliding_fee_action_ind],[resubmission_reference_nbr],[resubmission_cob],[tooth],[surface_description],[surface],[quadrant],[form],[start_time],[stop_time],[total_time],[base_unit],[alt_code],[referring_name],[referring_id],[transfer_nonpar_patpmt_ind],[transfer_nonpar_bal_ind],[anesthesia_billing_ind],[sim_dept_id],[note],[create_timestamp],[created_by],[modify_timestamp],[modified_by],[outsource_ind],[outsource_agency_id],[outsource_date],[enc_rate_ind],[custom_dunning_msg],[statement_aging_date],[create_timestamp_tz],[modify_timestamp_tz],[batch_post_dunning_msg_id],[optik_order_id],[credit_date],[anesthesia_units],[user_defined1_amt],[user_defined2_amt],[parent_tax_link_id],[rx_on_file_ind],[national_drug_code],[NDCId],[enc_changes_old_service_date],[enc_changes_old_location_id],[behavioral_billing_ind],[user_defined1_unit_price],[user_defined2_unit_price],[user_defined1_override_ind],[user_defined2_override_ind],[snomed_concept_id],[snomed_concept_id2],[snomed_concept_id3],[snomed_concept_id4],[dental_ind],[supernumerary_ind],[surface_descriptor],[defective_ind],[not_applicable_date],[approval_date],[asa_crosswalk_lib_id],[surgical_proc_code_id],[surgical_proc_desc],[parent_mda_link_id],[medical_director_id],[modifier_units],[time_based_units],[cob1_auth_code_id],[cob1_auth_code],[cob1_ref_code_id],[cob1_ref_code],[basis_of_measure],[national_drug_units],[cob2_auth_code_id],[cob2_auth_code],[cob2_ref_code_id],[cob2_ref_code],[cob3_auth_code_id],[cob3_auth_code],[cob3_ref_code_id],[cob3_ref_code],[cob1_resub_reference_nbr],[cob2_resub_reference_nbr],[cob3_resub_reference_nbr],[NDC_eff_date],[NDC_exp_date],[NDC_description],[NDC_drug_unit_price],[teeth],[units_from_timespan1],[units_from_timespan2],[units_from_timespan3],[unit_price_override],[time_based_price_override_ind],[icd9cm_code_id_5],[icd9cm_code_id_6],[icd9cm_code_id_7],[icd9cm_code_id_8],[icd9cm_code_id_9],[icd9cm_code_id_10],[icd9cm_code_id_11],[icd9cm_code_id_12],[icd9cm_code_desc_5],[icd9cm_code_desc_6],[icd9cm_code_desc_7],[icd9cm_code_desc_8],[icd9cm_code_desc_9],[icd9cm_code_desc_10],[icd9cm_code_desc_11],[icd9cm_code_desc_12],[ordering_id])
     VALUES(@enterpriseid,	@practiceid,	NULL,	NULL,	newid(),	@personid,	@newid,	'V',	@location,	@service_item_lib_id,	@sim,	'200.00',	'0.00',	'0.00',	'0.00',	'200.00',	'1.00',	'200.00',	'Y',	(SELECT CONVERT(VARCHAR(8),GETDATE(),112)),	(SELECT CONVERT(VARCHAR(8),GETDATE(),112)),	NULL,	NULL,	NULL,	NULL,	'U',	@prov,	NULL,	@cpt4,	'11',	@diag,	NULL,	NULL,	NULL,	@diagdesc,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',	'N',	'N',	NULL,	(SELECT CONVERT(VARCHAR(8),GETDATE(),112)),	'1',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',	'N',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'1500',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',	'N',	'N',	NULL,	NULL,	getdate(),	'0',	getdate(),	'0',	'N',	NULL,	NULL,	'N',	NULL,	(SELECT CONVERT(VARCHAR(8),GETDATE(),112)),	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	'N',	NULL,	NULL,	NULL,	NULL,	'N',	NULL,	NULL,	'N',	'N',	NULL,	NULL,	NULL,	NULL,	'N',	'N',	NULL,	'N',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL,	NULL)

set @loopcount = @loopcount -1
end --end loop
